package org.link_uuid.miningContestMod2026.database.redis;

import org.apache.logging.log4j.LogManager;
import redis.clients.jedis.Jedis;
import redis.clients.jedis.exceptions.JedisException;

import org.apache.logging.log4j.Logger;

public class RedisService {
    private static final Logger LOGGER = LogManager.getLogger();
    private static final String PLAYER_PREFIX = "player:";

    // 存储玩家数据
    // 读取玩家数据
    public static Integer getServerPlayerAmount(int serverIndex) {
        if (!RedisManager.isEnabled()) return null;

        try (Jedis jedis = RedisManager.getResource()) {
            // 使用更有意义的键名
            String redisKey = "server:" + serverIndex + ":player_amount";
            String value = jedis.get(redisKey);

            if (value != null) {
                return Integer.parseInt(value);
            }
            return 0;
        } catch (JedisException e) {
            LOGGER.error("读取服务器玩家数量失败: " + e.getMessage());
            return null;
        } catch (NumberFormatException e) {
            LOGGER.error("玩家数量数据格式错误: " + e.getMessage());
            return null;
        }
    }

    public static void saveServerPlayerAmount(int serverIndex, int serverPlayerAmount) {
        if (!RedisManager.isEnabled()) return;

        try (Jedis jedis = RedisManager.getResource()) {
            String redisKey = "server:" + serverIndex + ":player_amount";
            jedis.set(redisKey, String.valueOf(serverPlayerAmount));

            LOGGER.info("保存服务器 {} 玩家数量: {}");
        } catch (JedisException e) {
            LOGGER.info("保存服务器玩家数量失败: " + e.getMessage());
        }
    }

}